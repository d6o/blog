<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Self-Hosting a Firefox Sync Server | Diego Siqueira</title>
<meta name="keywords" content="Firefox Sync, Self-hosting, LibreWolf, Firefox, Syncstorage-rs, MariaDB, Reverse Proxy, Caddy, Server Management, Database, Docker, Open Source">
<meta name="description" content="After switching from Firefox to LibreWolf, I became interested in the idea of self-hosting my own Firefox Sync server. Although I had seen this was possible before, I had never really looked into it—until now. I embarked on a journey to set this up, and while it wasn&rsquo;t completely smooth sailing, I eventually got it working. Here&rsquo;s how it went.
Finding the Right Sync Server Initial Search: Mozilla&rsquo;s Sync Server Repo I started by searching for &ldquo;firefox sync server github&rdquo; and quickly found Mozilla&rsquo;s syncserver repo.">
<meta name="author" content="Diego Siqueira">
<link rel="canonical" href="http://localhost:1313/posts/firefox-sync-server/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/firefox-sync-server/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="Self-Hosting a Firefox Sync Server" />
<meta property="og:description" content="After switching from Firefox to LibreWolf, I became interested in the idea of self-hosting my own Firefox Sync server. Although I had seen this was possible before, I had never really looked into it—until now. I embarked on a journey to set this up, and while it wasn&rsquo;t completely smooth sailing, I eventually got it working. Here&rsquo;s how it went.
Finding the Right Sync Server Initial Search: Mozilla&rsquo;s Sync Server Repo I started by searching for &ldquo;firefox sync server github&rdquo; and quickly found Mozilla&rsquo;s syncserver repo." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/firefox-sync-server/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-09-06T08:52:32-03:00" />
<meta property="article:modified_time" content="2024-09-06T08:52:32-03:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="Self-Hosting a Firefox Sync Server"/>
<meta name="twitter:description" content="After switching from Firefox to LibreWolf, I became interested in the idea of self-hosting my own Firefox Sync server. Although I had seen this was possible before, I had never really looked into it—until now. I embarked on a journey to set this up, and while it wasn&rsquo;t completely smooth sailing, I eventually got it working. Here&rsquo;s how it went.
Finding the Right Sync Server Initial Search: Mozilla&rsquo;s Sync Server Repo I started by searching for &ldquo;firefox sync server github&rdquo; and quickly found Mozilla&rsquo;s syncserver repo."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Self-Hosting a Firefox Sync Server",
      "item": "http://localhost:1313/posts/firefox-sync-server/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Self-Hosting a Firefox Sync Server",
  "name": "Self-Hosting a Firefox Sync Server",
  "description": "After switching from Firefox to LibreWolf, I became interested in the idea of self-hosting my own Firefox Sync server. Although I had seen this was possible before, I had never really looked into it—until now. I embarked on a journey to set this up, and while it wasn\u0026rsquo;t completely smooth sailing, I eventually got it working. Here\u0026rsquo;s how it went.\nFinding the Right Sync Server Initial Search: Mozilla\u0026rsquo;s Sync Server Repo I started by searching for \u0026ldquo;firefox sync server github\u0026rdquo; and quickly found Mozilla\u0026rsquo;s syncserver repo.",
  "keywords": [
    "Firefox Sync", "Self-hosting", "LibreWolf", "Firefox", "Syncstorage-rs", "MariaDB", "Reverse Proxy", "Caddy", "Server Management", "Database", "Docker", "Open Source"
  ],
  "articleBody": "After switching from Firefox to LibreWolf, I became interested in the idea of self-hosting my own Firefox Sync server. Although I had seen this was possible before, I had never really looked into it—until now. I embarked on a journey to set this up, and while it wasn’t completely smooth sailing, I eventually got it working. Here’s how it went.\nFinding the Right Sync Server Initial Search: Mozilla’s Sync Server Repo I started by searching for “firefox sync server github” and quickly found Mozilla’s syncserver repo. This is an all-in-one package designed for self-hosting a Firefox Sync server. It bundles both the tokenserver for authentication and syncstorage for storage, which sounded like exactly what I needed.\nHowever, there were two red flags:\nThe repository had “failed” tags in the build history. A warning was prominently displayed stating that the repository was no longer being maintained and pointing to a new project in Rust. Switching to Rust: syncstorage-rs With that in mind, I followed the link to syncstorage-rs, which is a modern, Rust-based version of the original project. It seemed like the more viable option, so I decided to move forward with this one. But first, I wanted to check if there was a ready-to-go Docker image to make deployment easier. Unfortunately, there wasn’t one, but the documentation did mention running it with Docker.\nThis is where things started to get complicated.\nDiving Into Docker: Confusion and Complexity Documentation Woes The Docker documentation had some strange parts. For example, it mentioned:\nEnsuring that grpcio and protobuf versions matched the versions used by google-cloud-rust-raw. This sounded odd—shouldn’t Docker handle version dependencies automatically? Another confusing part was the instruction to manually copy the contents of mozilla-rust-sdk into the top-level root directory. Again, why wasn’t this step automated in the Dockerfile? At this point, I was feeling a bit uneasy but decided to push forward. I reviewed the repo, the Dockerfile, the Makefile, and the circleci workflows. Despite all that, I was still unsure how to proceed.\nA Simpler Solution: syncstorage-rs-docker I then stumbled upon dan-r’s syncstorage-rs-docker repo, which had a much simpler Docker setup. The description explained that the author had also encountered issues with the original documentation and decided to create a Docker container for their own infrastructure.\nAt this point, I felt reassured that I wasn’t alone in my confusion, and decided to give this setup a try.\nSetting Up the Server: Docker Compose and MariaDB Docker Compose Setup I copied the following services into my docker-compose.yaml:\nfirefox_mariadb: container_name: firefox_mariadb image: linuxserver/mariadb:10.6.13 volumes: - /data/ffsync/dbdata:/config restart: unless-stopped environment: MYSQL_DATABASE: syncstorage MYSQL_USER: sync MYSQL_PASSWORD: syncpass MYSQL_ROOT_PASSWORD: rootpass firefox_syncserver: container_name: firefox_syncserver build: context: /root/ffsync dockerfile: Dockerfile args: BUILDKIT_INLINE_CACHE: 1 restart: unless-stopped ports: - \"8000:8000\" depends_on: - firefox_mariadb environment: LOGLEVEL: info SYNC_URL: https://mydomain/sync SYNC_CAPACITY: 5 SYNC_MASTER_SECRET: mastersecret METRICS_HASH_SECRET: metricssecret SYNC_SYNCSTORAGE_DATABASE_URL: mysql://sync:usersync@firefox_mariadb:3306/syncstorage_rs SYNC_TOKENSERVER_DATABASE_URL: mysql://sync:usersync@firefox_mariadb:3306/tokenserver_rs A few tips:\nBe cautious with the database passwords. Avoid using special characters like \"/|%\" as they can cause issues during setup. I optimized the Dockerfile to make better use of caching, which reduced compilation time while testing. Initializing the Database I cloned the repository and copied the Dockerfile and initdb.sh script to my server. After making some tweaks, I ran the following steps to get the database up and running:\nBring up the MariaDB container: docker-compose up -d firefox_mariadb Make the initialization script executable and run it: chmod +x initdb.sh ./initdb.sh Bringing the Stack Online Finally, I brought up the entire stack with:\ndocker-compose up -d Configuring Reverse Proxy with Caddy Next, I needed to update my Caddy reverse proxy to point to the new Sync server. I added the following configuration:\nmydomain:443 { reverse_proxy firefox_syncserver:8000 { } } After updating Caddy with the DNS entry, I restarted the proxy and the sync server was up and running.\nChallenges Faced While I eventually got everything working, there were a few notable challenges along the way:\nDatabase persistence: I had issues with persistent data when restarting the MariaDB container. Make sure to clear out old data if needed. Server storage: My server ran out of space during the build process due to the size of the Docker images and intermediate files. Following the right steps: It took me a while to figure out the right steps, and much of the time was spent experimenting with the Docker setup. Final Thoughts Setting up a self-hosted Firefox Sync server is not the easiest task, especially if you’re not very familiar with Docker or database management. The official documentation is confusing, but thanks to community efforts like the syncstorage-rs-docker repo, it’s doable.\nIn the end, it took me about two hours to get everything running, but it was worth it. If you’re looking to control your own Firefox Sync server, this guide should help you avoid some of the pitfalls I encountered.\nHappy syncing!\n",
  "wordCount" : "800",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2024-09-06T08:52:32-03:00",
  "dateModified": "2024-09-06T08:52:32-03:00",
  "author":{
    "@type": "Person",
    "name": "Diego Siqueira"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/firefox-sync-server/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Diego Siqueira",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Diego Siqueira (Alt + H)">Diego Siqueira</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Self-Hosting a Firefox Sync Server
    </h1>
    <div class="post-meta"><span title='2024-09-06 08:52:32 -0300 -03'>September 6, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Diego Siqueira&nbsp;|&nbsp;<a href="https://github.com/d6o/blog/tree/main/content/posts/firefox-sync-server.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#finding-the-right-sync-server" aria-label="Finding the Right Sync Server">Finding the Right Sync Server</a><ul>
                        
                <li>
                    <a href="#initial-search-mozillas-sync-server-repo" aria-label="Initial Search: Mozilla&rsquo;s Sync Server Repo">Initial Search: Mozilla&rsquo;s Sync Server Repo</a></li>
                <li>
                    <a href="#switching-to-rust-syncstorage-rs" aria-label="Switching to Rust: syncstorage-rs">Switching to Rust: syncstorage-rs</a></li></ul>
                </li>
                <li>
                    <a href="#diving-into-docker-confusion-and-complexity" aria-label="Diving Into Docker: Confusion and Complexity">Diving Into Docker: Confusion and Complexity</a><ul>
                        
                <li>
                    <a href="#documentation-woes" aria-label="Documentation Woes">Documentation Woes</a></li>
                <li>
                    <a href="#a-simpler-solution-syncstorage-rs-docker" aria-label="A Simpler Solution: syncstorage-rs-docker">A Simpler Solution: syncstorage-rs-docker</a></li></ul>
                </li>
                <li>
                    <a href="#setting-up-the-server-docker-compose-and-mariadb" aria-label="Setting Up the Server: Docker Compose and MariaDB">Setting Up the Server: Docker Compose and MariaDB</a><ul>
                        
                <li>
                    <a href="#docker-compose-setup" aria-label="Docker Compose Setup">Docker Compose Setup</a></li>
                <li>
                    <a href="#initializing-the-database" aria-label="Initializing the Database">Initializing the Database</a></li>
                <li>
                    <a href="#bringing-the-stack-online" aria-label="Bringing the Stack Online">Bringing the Stack Online</a></li></ul>
                </li>
                <li>
                    <a href="#configuring-reverse-proxy-with-caddy" aria-label="Configuring Reverse Proxy with Caddy">Configuring Reverse Proxy with Caddy</a></li>
                <li>
                    <a href="#challenges-faced" aria-label="Challenges Faced">Challenges Faced</a></li>
                <li>
                    <a href="#final-thoughts" aria-label="Final Thoughts">Final Thoughts</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>After switching from Firefox to LibreWolf, I became interested in the idea of self-hosting my own Firefox Sync server.
Although I had seen this was possible before, I had never really looked into it—until now. I embarked on a journey to
set this up, and while it wasn&rsquo;t completely smooth sailing, I eventually got it working. Here&rsquo;s how it went.</p>
<h2 id="finding-the-right-sync-server">Finding the Right Sync Server<a hidden class="anchor" aria-hidden="true" href="#finding-the-right-sync-server">#</a></h2>
<h3 id="initial-search-mozillas-sync-server-repo">Initial Search: Mozilla&rsquo;s Sync Server Repo<a hidden class="anchor" aria-hidden="true" href="#initial-search-mozillas-sync-server-repo">#</a></h3>
<p>I started by searching for &ldquo;firefox sync server github&rdquo; and quickly
found <a href="https://github.com/mozilla-services/syncserver">Mozilla&rsquo;s syncserver repo</a>. This is an all-in-one package
designed for self-hosting a Firefox Sync server. It bundles both the tokenserver for authentication and syncstorage for
storage, which sounded like exactly what I needed.</p>
<p>However, there were two red flags:</p>
<ol>
<li>The repository had &ldquo;failed&rdquo; tags in the build history.</li>
<li>A warning was prominently displayed stating that the repository was no longer being maintained and pointing to a new
project in Rust.</li>
</ol>
<h3 id="switching-to-rust-syncstorage-rs">Switching to Rust: syncstorage-rs<a hidden class="anchor" aria-hidden="true" href="#switching-to-rust-syncstorage-rs">#</a></h3>
<p>With that in mind, I followed the link to <a href="https://github.com/mozilla-services/syncstorage-rs">syncstorage-rs</a>, which is
a modern, Rust-based version of the original project. It seemed like the more viable option, so I decided to move
forward with this one. But first, I wanted to check if there was a ready-to-go Docker image to make deployment easier.
Unfortunately, there wasn&rsquo;t one, but the documentation did mention running it with Docker.</p>
<p>This is where things started to get complicated.</p>
<h2 id="diving-into-docker-confusion-and-complexity">Diving Into Docker: Confusion and Complexity<a hidden class="anchor" aria-hidden="true" href="#diving-into-docker-confusion-and-complexity">#</a></h2>
<h3 id="documentation-woes">Documentation Woes<a hidden class="anchor" aria-hidden="true" href="#documentation-woes">#</a></h3>
<p>The Docker documentation had some strange parts. For example, it mentioned:</p>
<ul>
<li>Ensuring that <code>grpcio</code> and <code>protobuf</code> versions matched the versions used by <code>google-cloud-rust-raw</code>. This sounded
odd—shouldn&rsquo;t Docker handle version dependencies automatically?</li>
<li>Another confusing part was the instruction to manually copy the contents of <code>mozilla-rust-sdk</code> into the top-level root
directory. Again, why wasn&rsquo;t this step automated in the Dockerfile?</li>
</ul>
<p>At this point, I was feeling a bit uneasy but decided to push forward. I reviewed the repo, the Dockerfile, the
Makefile, and the circleci workflows. Despite all that, I was still unsure how to proceed.</p>
<h3 id="a-simpler-solution-syncstorage-rs-docker">A Simpler Solution: syncstorage-rs-docker<a hidden class="anchor" aria-hidden="true" href="#a-simpler-solution-syncstorage-rs-docker">#</a></h3>
<p>I then stumbled upon <a href="https://github.com/dan-r/syncstorage-rs-docker">dan-r&rsquo;s syncstorage-rs-docker repo</a>, which had a
much simpler Docker setup. The description explained that the author had also encountered issues with the
original documentation and decided to create a Docker container for their own infrastructure.</p>
<p>At this point, I felt reassured that I wasn&rsquo;t alone in my confusion, and decided to give this setup a try.</p>
<h2 id="setting-up-the-server-docker-compose-and-mariadb">Setting Up the Server: Docker Compose and MariaDB<a hidden class="anchor" aria-hidden="true" href="#setting-up-the-server-docker-compose-and-mariadb">#</a></h2>
<h3 id="docker-compose-setup">Docker Compose Setup<a hidden class="anchor" aria-hidden="true" href="#docker-compose-setup">#</a></h3>
<p>I copied the following services into my <code>docker-compose.yaml</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="nt">firefox_mariadb</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">firefox_mariadb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">linuxserver/mariadb:10.6.13</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/data/ffsync/dbdata:/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l">syncstorage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="l">sync</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">syncpass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">rootpass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">firefox_syncserver</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">firefox_syncserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l">/root/ffsync</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l">Dockerfile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">BUILDKIT_INLINE_CACHE</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8000:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">firefox_mariadb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">LOGLEVEL</span><span class="p">:</span><span class="w"> </span><span class="l">info</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SYNC_URL</span><span class="p">:</span><span class="w"> </span><span class="l">https://mydomain/sync</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SYNC_CAPACITY</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SYNC_MASTER_SECRET</span><span class="p">:</span><span class="w"> </span><span class="l">mastersecret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">METRICS_HASH_SECRET</span><span class="p">:</span><span class="w"> </span><span class="l">metricssecret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SYNC_SYNCSTORAGE_DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l">mysql://sync:usersync@firefox_mariadb:3306/syncstorage_rs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SYNC_TOKENSERVER_DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l">mysql://sync:usersync@firefox_mariadb:3306/tokenserver_rs</span><span class="w">
</span></span></span></code></pre></div><p>A few tips:</p>
<ul>
<li>Be cautious with the database passwords. Avoid using special characters like <code>&quot;/|%&quot;</code> as they can cause issues during
setup.</li>
<li>I optimized the Dockerfile to make better use of caching, which reduced compilation time while testing.</li>
</ul>
<h3 id="initializing-the-database">Initializing the Database<a hidden class="anchor" aria-hidden="true" href="#initializing-the-database">#</a></h3>
<p>I cloned the repository and copied the Dockerfile and <code>initdb.sh</code> script to my server. After making some tweaks, I ran
the following steps to get the database up and running:</p>
<ol>
<li>Bring up the MariaDB container:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose up -d firefox_mariadb
</span></span></code></pre></div></li>
<li>Make the initialization script executable and run it:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod +x initdb.sh
</span></span><span class="line"><span class="cl">./initdb.sh
</span></span></code></pre></div></li>
</ol>
<h3 id="bringing-the-stack-online">Bringing the Stack Online<a hidden class="anchor" aria-hidden="true" href="#bringing-the-stack-online">#</a></h3>
<p>Finally, I brought up the entire stack with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose up -d
</span></span></code></pre></div><h2 id="configuring-reverse-proxy-with-caddy">Configuring Reverse Proxy with Caddy<a hidden class="anchor" aria-hidden="true" href="#configuring-reverse-proxy-with-caddy">#</a></h2>
<p>Next, I needed to update my Caddy reverse proxy to point to the new Sync server. I added the following configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mydomain:443 <span class="o">{</span>
</span></span><span class="line"><span class="cl">     reverse_proxy firefox_syncserver:8000 <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>After updating Caddy with the DNS entry, I restarted the proxy and the sync server was up and running.</p>
<h2 id="challenges-faced">Challenges Faced<a hidden class="anchor" aria-hidden="true" href="#challenges-faced">#</a></h2>
<p>While I eventually got everything working, there were a few notable challenges along the way:</p>
<ol>
<li><strong>Database persistence</strong>: I had issues with persistent data when restarting the MariaDB container. Make sure to clear
out old data if needed.</li>
<li><strong>Server storage</strong>: My server ran out of space during the build process due to the size of the Docker images and
intermediate files.</li>
<li><strong>Following the right steps</strong>: It took me a while to figure out the right steps, and much of the time was spent
experimenting with the Docker setup.</li>
</ol>
<h2 id="final-thoughts">Final Thoughts<a hidden class="anchor" aria-hidden="true" href="#final-thoughts">#</a></h2>
<p>Setting up a self-hosted Firefox Sync server is not the easiest task, especially if you&rsquo;re not very familiar with Docker
or database management. The official documentation is confusing, but thanks to community efforts like
the <code>syncstorage-rs-docker</code> repo, it’s doable.</p>
<p>In the end, it took me about two hours to get everything running, but it was worth it. If you’re looking to control your
own Firefox Sync server, this guide should help you avoid some of the pitfalls I encountered.</p>
<p>Happy syncing!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/firefox-sync/">Firefox Sync</a></li>
      <li><a href="http://localhost:1313/tags/self-hosting/">Self-Hosting</a></li>
      <li><a href="http://localhost:1313/tags/librewolf/">LibreWolf</a></li>
      <li><a href="http://localhost:1313/tags/firefox/">Firefox</a></li>
      <li><a href="http://localhost:1313/tags/syncstorage-rs/">Syncstorage-Rs</a></li>
      <li><a href="http://localhost:1313/tags/mariadb/">MariaDB</a></li>
      <li><a href="http://localhost:1313/tags/reverse-proxy/">Reverse Proxy</a></li>
      <li><a href="http://localhost:1313/tags/caddy/">Caddy</a></li>
      <li><a href="http://localhost:1313/tags/server-management/">Server Management</a></li>
      <li><a href="http://localhost:1313/tags/database/">Database</a></li>
      <li><a href="http://localhost:1313/tags/docker/">Docker</a></li>
      <li><a href="http://localhost:1313/tags/open-source/">Open Source</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/reviving-retro-gaming-with-lakka-raspberry-pi-5/">
    <span class="title">« Prev</span>
    <br>
    <span>Reviving Retro Gaming With Lakka Raspberry Pi 5</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/internet-browsers/">
    <span class="title">Next »</span>
    <br>
    <span>My Journey Through Browsers: From Internet Explorer to LibreWolf</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Self-Hosting a Firefox Sync Server on x"
            href="https://x.com/intent/tweet/?text=Self-Hosting%20a%20Firefox%20Sync%20Server&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f&amp;hashtags=FirefoxSync%2cSelf-hosting%2cLibreWolf%2cFirefox%2cSyncstorage-rs%2cMariaDB%2cReverseProxy%2cCaddy%2cServerManagement%2cDatabase%2cDocker%2cOpenSource">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Self-Hosting a Firefox Sync Server on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f&amp;title=Self-Hosting%20a%20Firefox%20Sync%20Server&amp;summary=Self-Hosting%20a%20Firefox%20Sync%20Server&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Self-Hosting a Firefox Sync Server on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f&title=Self-Hosting%20a%20Firefox%20Sync%20Server">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Self-Hosting a Firefox Sync Server on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Self-Hosting a Firefox Sync Server on whatsapp"
            href="https://api.whatsapp.com/send?text=Self-Hosting%20a%20Firefox%20Sync%20Server%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Self-Hosting a Firefox Sync Server on telegram"
            href="https://telegram.me/share/url?text=Self-Hosting%20a%20Firefox%20Sync%20Server&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Self-Hosting a Firefox Sync Server on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Self-Hosting%20a%20Firefox%20Sync%20Server&u=http%3a%2f%2flocalhost%3a1313%2fposts%2ffirefox-sync-server%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Diego Siqueira</a></span>

</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
